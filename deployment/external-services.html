

<!doctype html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>External Services Configuration &mdash; Digital Rebar Docs</title>
    
    <link rel="stylesheet" href="../static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="../static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../static/jquery.js"></script>
    <script type="text/javascript" src="../static/underscore.js"></script>
    <script type="text/javascript" src="../static/doctools.js"></script>
    <script type="text/javascript" src="../static/bizstyle.js"></script>
    <link rel="shortcut icon" href="../static/digitalrebar.ico"/>
    <link rel="top" title="Digital Rebar Docs" href="../README.html" />
    <link rel="up" title="Deploy Guide" href="README.html" />
    <link rel="next" title="Interact with Chef" href="knife-config.html" />
    <link rel="prev" title="Digital Rebar Info (.dr_info)" href="dr_info.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="knife-config.html" title="Interact with Chef"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="dr_info.html" title="Digital Rebar Info (.dr_info)"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../README.html">DRebar</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="README.html" accesskey="U">Deploy Guide</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../README.html">
              <img class="logo" src="../static/digital_rebar_small.png" alt="Logo"/>
            </a></p>
  <h3><a href="../README.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">External Services Configuration</a><ul>
<li><a class="reference internal" href="#dns-domain-name-server">DNS (Domain Name Server)</a></li>
<li><a class="reference internal" href="#ntp-network-time-protocol">NTP (Network Time Protocol)</a></li>
<li><a class="reference internal" href="#dhcp-dynamic-host-configuration-protocol">DHCP (Dynamic Host Configuration Protocol)</a></li>
<li><a class="reference internal" href="#proxy-server">Proxy Server</a></li>
<li><a class="reference internal" href="#amqp-server-and-service">AMQP Server and Service</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="dr_info.html"
                        title="previous chapter">Digital Rebar Info (.dr_info)</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="knife-config.html"
                        title="next chapter">Interact with Chef</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/deployment/external-services.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="external-services-configuration">
<h1>External Services Configuration<a class="headerlink" href="#external-services-configuration" title="Permalink to this headline">¶</a></h1>
<div class="line-block">
<div class="line">The Digital Rebar System can be configured to utilize external (not</div>
</div>
<p>installed or managed by Digital Rebar) services.
| These configurations are made in the following file:
/opt/digitalrebar/core/rebar-config.sh and must be made <em>PRIOR</em> to
running production.sh to install the system. Users can configure any
combination of of these services.</p>
<div class="section" id="dns-domain-name-server">
<h2>DNS (Domain Name Server)<a class="headerlink" href="#dns-domain-name-server" title="Permalink to this headline">¶</a></h2>
<p>By default Digital Rebar will utilize Bind (named) on the Admin Node
when you install Digital Rebar. All clients will be configured to use
this system when they are installed. DNS entries are automatically
updated as new nodes are configured or removed from Digital Rebar.
Digital Rebar can be configured to use an already existing DNS however
it becomes the responsability of the user to ensure that entries are
created or removed as Digital Rebar will not function correctly if the
name and IP Address are not configured with the ones assigned by Digital
Rebar (Typically MAC address of the primary interface)</p>
<ul class="simple">
<li>Edit /opt/digitalrebar/core/rebar-config.sh</li>
<li>Find the line &#8216;rebar roles bind dns-bind_server to &#8220;$FQDN&#8221;&#8217; and
comment it out by adding # to the front of the line.</li>
<li>Find the line &#8216;#curl -X PUT -d &#8216;{&#8220;Datacenter&#8221;: &#8220;digitalrebar&#8221;,
&#8220;Node&#8221;: &#8220;external&#8221;, &#8220;Address&#8221;: &#8220;192.168.124.11&#8221;, &#8220;Service&#8221;:
{&#8220;Service&#8221;: &#8220;dns-service&#8221;, &#8220;Address&#8221;: &#8220;192.168.124.11&#8221;, &#8220;Port&#8221;: 43,
&#8220;Tags&#8221;: [ &#8220;system&#8221; ]} }&#8217; <a class="reference external" href="http://127.0.0.1:8500/v1/catalog/register">http://127.0.0.1:8500/v1/catalog/register</a>&#8216;
uncomment it by removing the # from the front of the line and then
change the IP address of the DNS server (192.168.124.11 in this
example) to the IP of the system which will be serving DNS for the
enviornment</li>
<li>Find the line &#8216;#curl -X PUT -d &#8216;POWERDNS&#8217;
<a class="reference external" href="http://127.0.0.1:8500/v1/kv/digitalrebar/private/dns/system/type?token=$CONSUL_MACL">http://127.0.0.1:8500/v1/kv/digitalrebar/private/dns/system/type?token=$CONSUL_MACL</a>`
uncomment it by removing the # from the front of the line.</li>
<li>Find the line &#8216;233 #curl -X PUT -d &#8216;POWERDNS&#8217;
<a class="reference external" href="http://127.0.0.1:8500/v1/kv/digitalrebar/private/dns/system/type?token=$CONSUL_MACL">http://127.0.0.1:8500/v1/kv/digitalrebar/private/dns/system/type?token=$CONSUL_MACL</a>&#8216;
and uncomment it by removing the # from the front of the link. Change
the POWERDNS to BIND if you aren&#8217;t running POWERDNS.</li>
<li>If you are running POWERDNS, uncomment the three curl lines right
below the previous curl command and update the -d parameters for your
POWERDNS server.</li>
<li>Save the file and continue on with the remainder of the installation
steps.</li>
</ul>
</div>
<div class="section" id="ntp-network-time-protocol">
<h2>NTP (Network Time Protocol)<a class="headerlink" href="#ntp-network-time-protocol" title="Permalink to this headline">¶</a></h2>
<p>By default Digital Rebar will utilize NTP (NTPd) on the Admin node and
all clients will be configured to use this server to sync their times.
Digital Rebar can be configured not run NTP on the admin server and
configure any nodes installed so to point their clients to the IP address
specified in this file.</p>
<ul class="simple">
<li>Edit /opt/digitalrebar/core/rebar-config.sh</li>
<li>Find the line &#8216;rebar roles bind ntp-server to &#8220;$FQDN&#8221; and comment it
out by adding # to the front of the line</li>
<li>Find the line &#8216;#curl -X PUT -d &#8216;{&#8220;Datacenter&#8221;: &#8220;digitalrebar&#8221;,
&#8220;Node&#8221;: &#8220;external&#8221;, &#8220;Address&#8221;: &#8220;192.168.124.11&#8221;, &#8220;Service&#8221;:
{&#8220;Service&#8221;: &#8220;ntp-service&#8221;, &#8220;Address&#8221;: &#8220;192.168.124.11&#8221;, &#8220;Port&#8221;: 123,
&#8220;Tags&#8221;: [ &#8220;system&#8221; ]} }&#8217; <a class="reference external" href="http://127.0.0.1:8500/v1/catalog/register">http://127.0.0.1:8500/v1/catalog/register</a>&#8216;
uncomment it by removing the # from the front of the line and then
change the IP address of the NTP server (192.168.124.11 in this
example) to the IP of the system which will be serving DNS for the
enviornment.</li>
<li>Save the file and continue on with the remainder of the installation
steps.</li>
</ul>
</div>
<div class="section" id="dhcp-dynamic-host-configuration-protocol">
<h2>DHCP (Dynamic Host Configuration Protocol)<a class="headerlink" href="#dhcp-dynamic-host-configuration-protocol" title="Permalink to this headline">¶</a></h2>
<p>By default Digital Rebar will configure DHCP (dhcpd) on the Admin node
and utilize it to preform boot sequences to nodes as they transition
from discovery to OS installation. Additionally it will direct a system
to use it&#8217;s local drives to boot once an OS has been installed. Digital Rebar
can be configured to use an already existing DHCP Server however it
becomes the responsability of the user to ensure that nodes keep the
same IP address.</p>
<ul class="simple">
<li>Edit /opt/digitalrebar/core/rebar-config.sh</li>
<li>Find the line &#8216;rebar roles bind dhcp-database to &#8220;$FQDN&#8221;&#8217; and comment
it out by adding # to the front of the line.</li>
<li>Save the file and continue on with the remainder of the installation
steps.</li>
<li>On the DHCP server the user must redirect the node which is booting
to the Digital Rebar Admin server. To do this add the following
stanza to /etc/dhcpd/dhcpd.conf</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span></span>subnet 192.168.124.0 netmask 255.255.255.0 {
 option routers 192.168.124.10;
 option subnet-mask 255.255.255.0;
 option broadcast-address 192.168.124.255;
 option domain-name &quot;neode.com&quot;;
 option domain-name-servers 192.168.124.11;
 default-lease-time 7200;
 max-lease-time 36000;
  pool {
    range 192.168.124.81 192.168.124.254;
    allow unknown-clients;
    if option arch = 00:06 {
     filename = &quot;discovery/bootia32.efi&quot;;
  } else if option arch = 00:07 {
     filename = &quot;discovery/bootx64.efi&quot;;
  } else {
     filename = &quot;discovery/pxelinux.0&quot;;
  }
    next-server 192.168.124.10;
  }
}
</pre></div>
</div>
<ul class="simple">
<li>Replace the subet, domain-name and pool information to match the
enviornment.</li>
<li>Put the IP address of the Digital Rebar Admin Node in the next-server
in place of 192.168.124.10.</li>
</ul>
</div>
<div class="section" id="proxy-server">
<h2>Proxy Server<a class="headerlink" href="#proxy-server" title="Permalink to this headline">¶</a></h2>
<p>By default, Digital Rebar will install a Proxy server on the Admin server
in order to facilitate access to packages on the internet by the target
nodes. After installation Digital Rebar will install various packages
based on the roles that are assigned to these devices. As Digital Rebar
caches the packages as they are downloaded from the internet (Note: they are only
pulled down once even if multiple systems will be accessing them). It is
possible for a user to define a different proxy server if one already
exists in the enviornment.</p>
<ul class="simple">
<li>Edit /opt/digitalrebar/core/rebar-config.sh</li>
<li>Find the line &#8216;rebar roles bind proxy-server to &#8220;$FQDN&#8221;` and comment
it out by adding # to the front of the line</li>
<li>Find the line &#8216;curl -X PUT -d &#8216;{&#8220;Datacenter&#8221;: &#8220;digitalrebar&#8221;, &#8220;Node&#8221;:
&#8220;external&#8221;, &#8220;Address&#8221;: &#8220;192.168.124.9&#8221;, &#8220;Service&#8221;: {&#8220;Service&#8221;:
&#8220;proxy-service&#8221;, &#8220;Address&#8221;: &#8220;192.168.124.9&#8221;, &#8220;Port&#8221;: 3128, &#8220;Tags&#8221;: [
&#8220;system&#8221; ]} }&#8217; <a class="reference external" href="http://127.0.0.1:8500/v1/catalog/register">http://127.0.0.1:8500/v1/catalog/register</a> ` uncomment
it by removing the # from the front of the line and then change the
IP address of the proxy server (192.168.124.9 in this example) as
well as the port (3128 in this example) to the IP and port of the
proxy server for the enviornment.</li>
<li>Save the file and continue on with the remainder of the installation
steps.</li>
</ul>
</div>
<div class="section" id="amqp-server-and-service">
<h2>AMQP Server and Service<a class="headerlink" href="#amqp-server-and-service" title="Permalink to this headline">¶</a></h2>
<p>Optionally, Digital Rebar can be configured to send events to an AMQP
server through the AMQP service. To do this, either Digital Rebar should
run its own RabbitMQ server or an AMQP service can be injected into
Digital Rebar. The system currently assumes a user of <em>rebar</em>, a
password of <em>rebar</em>, and a virtual host of <em>/digitalrebar</em>.</p>
<p>To run a RabbitMQ service, uncomment the rabbitmq-server line in
rebar-config.sh.</p>
<p>To inject an AMQP service instead, uncomment the curl line for consul.
It is next to the rabbitmq-server line.</p>
<p>In either case, the amqp-service needs to be enabled. Uncomment the
amqp-service rebar bind command.</p>
<p>Once the system is operational and the services configured, you will
need to start the audit-to-event program. To do this, you will need to
run the following command as <em>rebar</em> from the
<em>/opt/digitalrebar/core/rails</em> directory: RAILS_ENV=production bundle
exec rake audits.to_amqp &amp;</p>
<p>To see events as they happen, a sample client can be run as <em>rebar</em> from
the <em>/opt/digitalrebar/core/rails</em> directory: RAILS_ENV=production
bundle exec scripts/event_client.rb #</p>
<p>The command line arguments are filters. # means all. Node.create will
return events when nodes are created. Other options are available.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="knife-config.html" title="Interact with Chef"
             >next</a> |</li>
        <li class="right" >
          <a href="dr_info.html" title="Digital Rebar Info (.dr_info)"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../README.html">DRebar</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="README.html" >Deploy Guide</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2016, RackN team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.6.
    </div>
  </body>
</html>