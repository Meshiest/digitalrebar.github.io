

<!doctype html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>What is the Current State of UEFI: &mdash; Digital Rebar Docs</title>
    
    <link rel="stylesheet" href="../_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/bizstyle.js"></script>
    <link rel="shortcut icon" href="../_static/digitalrebar.ico"/>
    <link rel="top" title="Digital Rebar Docs" href="../README.html" />
    <link rel="up" title="Frequently Asked Questions (FAQ)" href="README.html" />
    <link rel="next" title="How do I add GEMs to my barclamps?" href="adding_gems.html" />
    <link rel="prev" title="Frequently Asked Questions (FAQ)" href="README.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="adding_gems.html" title="How do I add GEMs to my barclamps?"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="README.html" title="Frequently Asked Questions (FAQ)"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../README.html">DRebar</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="README.html" accesskey="U">Frequently Asked Questions (FAQ)</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../README.html">
              <img class="logo" src="../_static/digital_rebar_small.png" alt="Logo"/>
            </a></p>
  <h3><a href="../README.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">What is the Current State of UEFI:</a></li>
<li><a class="reference internal" href="#how-to-use-uefi">How To Use UEFI:</a></li>
<li><a class="reference internal" href="#what-uefi-gives-you">What UEFI Gives You:</a></li>
<li><a class="reference internal" href="#what-does-not-work">What Does Not Work:</a></li>
<li><a class="reference internal" href="#what-had-to-be-changed">What Had to Be Changed:</a></li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="README.html"
                        title="previous chapter">Frequently Asked Questions (FAQ)</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="adding_gems.html"
                        title="next chapter">How do I add GEMs to my barclamps?</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/faq/UEFI.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="what-is-the-current-state-of-uefi">
<h1>What is the Current State of UEFI:<a class="headerlink" href="#what-is-the-current-state-of-uefi" title="Permalink to this headline">¶</a></h1>
<p>This file documents the current state of UEFI booting in Digital Rebar.</p>
<p>Right now, we have basic support for network booting systems running in
UEFI mode. We are able to netboot Sledgehammer and the OS install
kernel/initrd pairs, and get to the point where we have an installed
operating system on the compute nodes.</p>
</div>
<div class="section" id="how-to-use-uefi">
<h1>How To Use UEFI:<a class="headerlink" href="#how-to-use-uefi" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li>Switch your system to operate in UEFI mode. How this is done varies
from system to system.</li>
<li>Once the system is in UEFI mode, configure it to network boot off the
first nic.</li>
<li>The rebar framework will handle things from there.</li>
</ul>
</div>
<div class="section" id="what-uefi-gives-you">
<h1>What UEFI Gives You:<a class="headerlink" href="#what-uefi-gives-you" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li>Native support for drive sizes &gt; 2TB.</li>
<li>All new low-level system firmware.</li>
</ul>
</div>
<div class="section" id="what-does-not-work">
<h1>What Does Not Work:<a class="headerlink" href="#what-does-not-work" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li>Booting Ubuntu 12.04 off the hard drive.</li>
</ul>
<p>There is a bug in how the version of Grub 2 that comes with Ubuntu
handles memory mapping in the UEFI environment that causes the system to
crash the UEFI firmware when it tries to load the kernel and initrd.
Upstream grub2 has been patched to resolve this issue, but the updates
have not been pulled into Ubuntu 12.04 yet.</p>
<p>Patch is at <a class="reference external" href="http://savannah.gnu.org/bugs/?36532">http://savannah.gnu.org/bugs/?36532</a>.</p>
<p>Possible workarounds include: * Look at using grub-legacy or elilo
instead of grub2 when installing in UEFI mode. * Working on getting
Canonical to pull in an updated version of Grub2 that has the patch that
fixes the issue.</p>
</div>
<div class="section" id="what-had-to-be-changed">
<h1>What Had to Be Changed:<a class="headerlink" href="#what-had-to-be-changed" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li>We now generate per-node OS installation scripts and UEFI/PXE config
files on the fly instead of having per-OS install scripts and config
files. This was needed to support network installation of Redhat and
CentOS due to anaconda not being able to find out what NIC it booted
from when installing in UEFI mode. For consistency between the UEFI
and PXE netboot codepaths, the per-machine UEFI and PXE config files
are now IP address specific instead of MAC address specific.</li>
<li>When systems operate in UEFI mode, we manage the boot order directly
instead of assuming that we will always netboot.</li>
</ul>
<p>Each of the OS flavors we support uses a different bootloader for UEFI (CentOS
and Redhat use grub1, and Ubuntu uses grub2), and they do not have the
right intersection of being able to netboot, being able to chainload,
and operating reliably in a network environment to be useful. Instead we
use elilo, and we grab the precompiled EFI app from Sourceforge instead
of trying to compile things ourselves, playing packaging shennanigans to
keep our admin node bootable while juggling multiple bootloaders, or
have the provisioner handle messing with boot templates for multiple
different bootloaders.</p>
<p>However, none of the UEFI capable bootloaders have been found have the
ability to hand control back to UEFI to try the next thing in the boot
sequence, which means that we can no longer assume that we will always
netboot. Instead, efibootmgr has been added to Sledgehammer and the
default package installs for the operating systems, and a piece of
code has been added to the rebar-hacks recipe in the deployer that knows how to change
the boot order to either be nics-first or nics-last. That is
based on the PXE state machine &#8211; if it is in execute state, it will set
things to nics-last, otherwise it will set things to nics-first.</p>
<p>In order to make that work reliably, the community to modify the provisioner
state machine to run chef-client on every node that is transitioning out
of the execute state in order to ensure that the boot sequence gets
updated. This failed when transitioning into reset or delete, because
those states deallocate all IP addresses to the nodes. To cope with
that, the network barclamp recognizes when the admin network is being
removed and arranges for the system to run dhcplient on all the
interfaces until it gets an IP address. Since we run chef-client on the
nodes before running it on the admin node, this should result in the
system getting the same IP address it had before, which will let the
chef-client run continue.</p>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="adding_gems.html" title="How do I add GEMs to my barclamps?"
             >next</a> |</li>
        <li class="right" >
          <a href="README.html" title="Frequently Asked Questions (FAQ)"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../README.html">DRebar</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="README.html" >Frequently Asked Questions (FAQ)</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2016, RackN team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.6.
    </div>
  </body>
</html>